<html>

<head><script>(function(w,i,g){w[g]=w[g]||[];if(typeof w[g].push=='function')w[g].push(i)})
(window,'AW-1055364430','google_tags_first_party');</script><script async src="/925q/"></script>
			<script>
				window.dataLayer = window.dataLayer || [];
				function gtag(){dataLayer.push(arguments);}
				gtag('js', new Date());
				gtag('set', 'developer_id.dYzg1YT', true);
				gtag('config', 'AW-1055364430');
			</script>
			

<!--Meta stuff-->

<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.0.0/animate.min.css"/>

<script src="js/v3-api.js"></script>

<title>High Heels Dash</title>

<style>

    * {

        -moz-box-sizing: border-box;

        -webkit-box-sizing: border-box;

        box-sizing: border-box;

        font-family: sans-serif;

        font-weight: 400;

        outline: none;

        user-select: none;

    }

    body {

        margin: 0;

        overflow: hidden;

    }

    #loading:hover{cursor: pointer;}

    #loading {

      z-index: 1000;

        position: fixed;

        left: 0;

        top: 0;

        width: 100%;

        height: 100%;

        color: white;

        text-align: center;

        font-size: 30px;

        font-weight: 100;

        background-color: #4153A5;

        text-shadow:         /* create a black outline */

        -1px -1px 0 #000,

         0   -1px 0 #000,

         1px -1px 0 #000,

         1px  0   0 #000,

         1px  1px 0 #000,

         0    1px 0 #000,

        -1px  1px 0 #000,

        -1px  0   0 #000;



    }

    #loading>div {

        margin-top: 30vh;

    }

    .progress {

        margin-top: 1vh;

        display: inline-block;

        border-radius: 10vw;

        width: 50vw;

        height: 1.5vw;

        background-color: #2B292A;

    }

    #progressbar {

        width: 0;

        border-radius: 10vw;

        height: 1.5vw;

        background: rgb(253,105,41);

        background: -moz-linear-gradient(90deg, rgba(253,105,41,1) 19%, rgba(244,192,41,1) 100%);

        background: -webkit-linear-gradient(90deg, rgba(253,105,41,1) 19%, rgba(244,192,41,1) 100%);

        background: linear-gradient(90deg, rgba(253,105,41,1) 19%, rgba(244,192,41,1) 100%);

        filter: progid:DXImageTransform.Microsoft.gradient(startColorstr="#fd6929",endColorstr="#f4c029",GradientType=1);

    }

    #lagged {

        margin-bottom: 10vh;

        display: inline-block;

        width: 30vh;

        height: 30vh;

        background-image: url(Images/lagged.png);

        background-repeat: no-repeat;

        background-size:contain;

    }

    #c {

        position: fixed;

        left: 0;

        top: 0;

        width: 100%;

        height: 100%;

        display: block;

    }

    #btnSound {

        position: fixed;

        left: 0.5%;

        top: 1%;

        width: 8%;

        height: 8%;

        visibility: hidden;

        background-image: url(Images/btnSound.png);

        background-repeat: no-repeat;

        background-size:contain;

    }

    .button {

        transition: all .1s;

        cursor: pointer;

        user-select: none;

    }

    .button:hover {

        transform: scale(1.1);

    }

    #instruction {

        visibility: hidden;

    }

    #bar {

        position: fixed;

        width: 20%;

        height: 10%;

        bottom: 2%;

        left:0;

        right:0;

        margin: 0 auto;



        background-image: url(Images/slide.png);

        background-repeat: no-repeat;

        background-size:contain;

    }

    #hand {

        width: 40%;

        height: 10%;

        position: fixed;

        bottom: 2%;

        left: 48%;



        background-image: url(Images/hand.png);

        background-repeat: no-repeat;

        background-size:contain;

        animation: leftRightAnim 2s linear infinite;

    }

    @keyframes leftRightAnim {

        33% {transform: translateX(20%);}

        66% {transform: translateX(-20%);}

    }

    #ingameLagged {

        display: inline-block;

        width: 25vh;

        height: 12vh;

        background-image: url(Images/lagged2.png);

        background-repeat: no-repeat;

        background-size:contain;



    }

    #gameUI {

        position: fixed;

        text-align: center;

        width: 100%;

        height: 100%;

        left: 0;

        top: 0;

        visibility: hidden;

    }

    #lvlNo {

        display: inline-block;

        margin-top: -2vh;

        text-align: center;

        color: white;

        font-size: 300%;

        font-weight: 800;

        text-shadow: 0px 4px 0px rgba(0, 0, 0, 0.6),2px 2px 4px #000000,         /* create a black outline */

        -1px -1px 0 #000,

         0   -1px 0 #000,

         1px -1px 0 #000,

         1px  0   0 #000,

         1px  1px 0 #000,

         0    1px 0 #000,

        -1px  1px 0 #000,

        -1px  0   0 #000;



    }

    #scoreText {

        position: fixed;

        padding: 0 2%;

        right: 0.5%;

        top: 0.5%;

        text-align: center;

        color: yellow;

        font-size: 350%;

        font-weight: 800;

        text-shadow: 0px 4px 0px rgba(0, 0, 0, 0.6),2px 2px 4px #000000,         /* create a black outline */

        -1px -1px 0 #000,

         0   -1px 0 #000,

         1px -1px 0 #000,

         1px  0   0 #000,

         1px  1px 0 #000,

         0    1px 0 #000,

        -1px  1px 0 #000,

        -1px  0   0 #000;

       background-color: rgba(0,0,0,0.5);

       border-radius: 25px;

    }

    #gameOverUI {

        position: fixed;

        left: 0;

        top: 0;

        width: 100%;

        height: 100%;

        text-align: center;

        visibility: hidden;

        background-color: rgba(0,0,0,0.5);

    }

    #moreGames {

        display: inline-block;

        width: 400px;

        height: 400px;

        background-color: rgba(0,0,0,0.5);

        color: white;

        margin-top: 1.2%;

    }

    /* add #moreGames h3 and .thumbWrapper style ~lagged template */

    #moreGames h3{float:left;clear:both;width:100%;line-height:16px;height:16px;font-size:16px;font-weight:600;padding-top:3px}

    .thumbWrapper{overflow:hidden;position:relative;background-color:#a5a5a5;box-shadow:0 0 4px 0 rgba(0,0,0,.5);margin:3% 0 0 5%;width:43%;padding-bottom:43%;border-radius:5px}.thumbWrapper div{top:0;left:0;right:0;bottom:0;overflow:hidden;border-radius:5px}.thumbWrapper a{top:0;left:0;bottom:0;right:0;z-index:200;text-indent:-99999px}.thumbWrapper img{width:100%;height:100%;border-radius:2px}.thumbWrapper span.thumbname{position:absolute;transition:bottom .6s ease;font-size:15px;font-weight:700;letter-spacing:1px;width:100%;bottom:-125%;left:0;height:auto;min-height:18px;line-height:20px;padding:7px 0 4px;text-align:center;text-transform:uppercase;background-color:rgba(42,100,144,.8);color:#fff;border-bottom-left-radius:2px;border-bottom-right-radius:2px}.thumbWrapper:hover span{display:block}



    #btnNext{

        display: inline-block;

        padding: 0 0.5%;

        border-radius: 20px;

        margin-top: 19vh;

        background-color: springgreen;



        color: white;

        font-size: 320%;

        font-weight: 800;

        text-shadow: 0px 4px 0px rgba(0, 0, 0, 0.6),2px 2px 4px #000000,

        -1px -1px 0 #000,

         0   -1px 0 #000,

         1px -1px 0 #000,

         1px  0   0 #000,

         1px  1px 0 #000,

         0    1px 0 #000,

        -1px  1px 0 #000,

        -1px  0   0 #000;

        line-height: 80px;

    }

    #btnRestart{

        display: inline-block;

        padding: 0 0.5%;

        border-radius: 20px;

        margin-top: 19vh;

        background-color: springgreen;



        color: white;

        font-size: 320%;

        font-weight: 800;

        text-shadow: 0px 4px 0px rgba(0, 0, 0, 0.6),2px 2px 4px #000000,

        -1px -1px 0 #000,

         0   -1px 0 #000,

         1px -1px 0 #000,

         1px  0   0 #000,

         1px  1px 0 #000,

         0    1px 0 #000,

        -1px  1px 0 #000,

        -1px  0   0 #000;

        line-height: 80px;

    }

    #goMessage {

        color: white;

        font-size: 300%;

        font-weight: 800;



        display: inline-block;

        margin-top: 1%;

        text-shadow: 0px 4px 0px rgba(0, 0, 0, 0.6),2px 2px 4px #000000,

        -1px -1px 0 #000,

         0   -1px 0 #000,

         1px -1px 0 #000,

         1px  0   0 #000,

         1px  1px 0 #000,

         0    1px 0 #000,

        -1px  1px 0 #000,

        -1px  0   0 #000;

    }

    #rotateDeviceBG {

        background-color: rgba(0,0,0,1);

        position: fixed;

        width: 100%;

        height: 100%;

        text-align: center;

        visibility: hidden;

    }

    .phone {

        position: fixed;

        height: 100px;

        width: 200px;

        border: 4px solid white;

        border-radius: 10px;

        animation: rotate 1.5s ease-in-out infinite alternate;

        left: 38%;

        top: 25%;

        /* display: none; */

    }



    .message {

        position: fixed;

        left: 40%;

      color: white;

      font-size: 1em;

      bottom: 15%;

      /* display: none; */

    }



    @keyframes rotate {

      0% {

            transform: rotate(0deg)

        }

        50% {

            transform: rotate(-90deg)

        }

        100% {

            transform: rotate(-90deg)

        }

    }

    @media only screen and (max-width: 700px) {

        #loading {

            font-size: 20px;

        }

        .progress {

            width: 70vw;

        }

        #moreGames {

            width: 350px;

            height: 350px;

            margin-top: 5%

        }

        #goMessage {

            font-size: 250%;

            font-weight: 700;

            margin-top: 10%

        }

        #btnNext{

            font-size: 170%;

        }

        #btnRestart{

            font-size: 170%;

        }

        #lvlNo {

            font-size: 250%;

            font-weight: 800;

        }

        #scoreText {

            font-size: 180%;

            font-weight: 800;

        }

        #btnSound {

            width: 11%;

            height: 11%;

        }

        #ingameLagged {

            width: 20vh;

            height: 10vh;

        }

        #bar {



            width: 40%;

            height: 20%;

            bottom: -8%;



        }

        #hand {

            width: 30%;

            height: 10%;

        }

    }



</style>



</head>

<body>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r113/three.min.js"></script>

<script src="./Libs/FBXLoader.js"></script>

<script src="./Libs/inflate.min.js"></script>

<script src="./Libs/SkeletonUtils.js"></script>

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.4.0/dist/confetti.browser.min.js"></script>



<div id="loading">

    <div>

        <div id="lagged"></div>

        <div id="progressText">0%</div>

        <div class="progress"><div id="progressbar"></div></div>

        <div id="loaderthing">Loading...</div>

    </div>

</div>



<canvas id="c"></canvas>



<div id="instruction">

    <div id="bar"></div>

    <div id="hand"></div>

</div>



<div id="gameUI">

    <div id="ingameLagged"></div><br>

    <div id="lvlNo">Level 1</div><br>

    <div id="scoreText" class="animate__faster">00</div><br>

</div>



<div id="gameOverUI">

    <div id="btnRestart" onclick="btnRestart()" class="button">Try Again</div><br>

    <div id="btnNext" onclick="btnContinue()" class="button">Continue &raquo;</div><br>

    <div id="moreGames">



<!--can use these defaults for more games ~lagged template-->



<h3>More Games</h3>

<div class="thumbWrapper newboxshadow firstgame"><div>

<a href="https://lagged.com/en/g/high-heels-online" target="_blank">High Heels Online</a>

<img src="https://imgs2.dab3games.com/high-heels-online-game364.png" width="200" height="200" alt="game" />

<span class="thumbname"><span>High Heels Online</span></span>

</div></div>

<div class="thumbWrapper newboxshadow"><div>

<a href="https://lagged.com/en/g/elastic-man" target="_blank" title="game">Elastic Man</a>

<img src="https://imgs2.dab3games.com/elastic-man-game.png" width="200" height="200" alt="game" />

<span class="thumbname"><span>Elastic Man</span></span>

</div></div>



<div class="thumbWrapper newboxshadow"><div>

<a href="https://lagged.com/en/g/hair-dash-challenge" target="_blank" title="game">Hair Dash Challenge</a>

<img src="https://imgs2.dab3games.com/hair-dash-challenge-game46.png" width="200" height="200" alt="game" />

<span class="thumbname"><span>Hair Dash Challenge</span></span>

</div></div>



<div class="thumbWrapper newboxshadow"><div>

<a href="https://lagged.com/en/g/among-us-online" target="_blank">Among Us Online</a>

<img src="https://imgs2.dab3games.com/among-us-online-game.png" width="200" height="200" alt="game" />

<span class="thumbname"><span>Among Us Online</span></span>

</div></div>



  </div>





    <br>





    <div id="goMessage" class="animate__animated animate__tada animate__infinite">Level Complete!</div><br>

</div>



<div id="btnSound"  class="button" onclick="btnSound()"></div>



<div id="rotateDeviceBG">

    <div class="phone">

    </div>

    <div class="message">

      Please rotate your device!

    </div>

</div>



<script>

// GLOBAL VAR

//console.warn = function(){};

var scene = null;

var camera = null;

var renderer = null;

var clock = new THREE.Clock();



var updateArray = [];

var playerModel = {};

var heels = {};

var player = null;

var spawner = null;

var collisionArray = [];

try{

var level = parseInt(localStorage.getItem("highHeelDash"));

}catch(e){

  console.log(e);

}

if (!level > 0)

level = 1;

var gameOver = false;

var score = 0;

var particleArray = [];

var onMobile = false;



const BaseModel = {

    level0: {url: 'Models/level0.fbx'},

    level1: {url: 'Models/level1.fbx'},

    level2: {url: 'Models/level2.fbx'},

    level3: {url: 'Models/level3.fbx'},

    level4: {url: 'Models/level4.fbx'},

    heel: {url: 'Models/heel.fbx'},

}

const Anims = {

    die: {url: 'Models/a_die.fbx'},

    slide: {url: 'Models/a_slide.fbx'},

    dance: {url: 'Models/a_dance.fbx'},

}

const Textures = {

    shadow: {url: 'Images/shadow.png'},

    explosion: {url: 'Images/explosion.png'},

}

const Sound = {

    music: {url: 'Sound/music.mp3'},

    add: {url: 'Sound/add.mp3'},

    button: {url: 'Sound/button.mp3'},

    complete: {url: 'Sound/complete.mp3'},

    die: {url: 'Sound/die.mp3'},

    remove: {url: 'Sound/remove.mp3'},

    slide: {url: 'Sound/slide.mp3'},

}



// DOM elements

const CANVAS = document.querySelector('#c');

const PROGRESS_TEXT = document.querySelector('#progressText');

const GAME_UI = document.querySelector('#gameUI');

const INSTRUCTION = document.querySelector('#instruction');

const BTN_SOUND = document.querySelector('#btnSound');

const GAMEOVER_UI = document.querySelector('#gameOverUI');

const SCORE = document.querySelector('#scoreText');

const LEVEL = document.querySelector('#lvlNo');

const ROTATE_MSG  = document.querySelector('#rotateDeviceBG');

const BTN_RESTART = document.querySelector('#btnRestart');

const BTN_NEXT = document.querySelector('#btnNext');

const GO_MESSAGE = document.querySelector('#goMessage');



function preload() {

    const progressbarElem = document.querySelector('#progressbar');

    let manager = new THREE.LoadingManager();

    manager.onStart = function ( url, itemsLoaded, itemsTotal ) {

        //console.log( 'Started loading file: ' + url + '.\nLoaded ' + itemsLoaded + ' of ' + itemsTotal + ' files.' );

    };

    manager.onLoad = function ( ) {

        //console.log( 'Loading complete!');

        //init();

        // hide the loading bar

        const loadingElem = document.querySelector('#loading');

        loadingElem.onclick=function(){init();}

        document.getElementById('loaderthing').innerHTML="Tap to Play";

        try{

        document.getElementById('progressText').style.display="none";

        document.getElementById('progressbarmain').style.display="none";

        document.getElementById('lagged').style.display="none";

        }catch(e){

          console.log(e);

        }



    };

    manager.onProgress = function ( url, itemsLoaded, itemsTotal ) {

        //console.log( 'Loading file: ' + url + '.\nLoaded ' + itemsLoaded + ' of ' + itemsTotal + ' files.' );

        progressbarElem.style.width = `${itemsLoaded / itemsTotal * 100 | 0}%`;

        PROGRESS_TEXT.innerHTML = `${itemsLoaded / itemsTotal * 100 | 0}%`;

    };

    manager.onError = function ( url ) {

        //console.log( 'There was an error loading ' + url );

    };



    var loader = new THREE.FBXLoader( manager );

    // load base character model

    for (const model of Object.values(BaseModel)) {

        loader.load( model.url, function ( fbx ) {

            model.fbx = fbx;

        });

    }

    // load anims

    for (const model of Object.values(Anims)) {

        loader.load( model.url, function ( fbx ) {

            //model.fbx = fbx;

            model.animation = fbx.animations[ 0 ];

        });

    }

    // load textures

    var loaderTex = new THREE.TextureLoader(manager);

    for (const img of Object.values(Textures)) {

        loaderTex.load( img.url, function(texture) {

            texture.encoding = THREE.sRGBEncoding;

            img.texture = texture;

        });

    }

    // load audio

    Sound.listener = new THREE.AudioListener();

    const audioLoader = new THREE.AudioLoader( manager );

    for (const key of Object.values(Sound)) {

        audioLoader.load( key.url, function(buffer) {

            key.sound = new THREE.Audio( Sound.listener );

            key.sound.setBuffer( buffer );

            key.sound.setVolume( 2 );

            if (key.url == 'Sound/music.mp3'){

                key.sound.setLoop( true );

                key.sound.setVolume( 0.7 );

            }

        });

    }

    // load character

    loader.load( 'Models/girl.fbx', function( object ) {

        object.traverse(function(child) {

            if (child instanceof THREE.Mesh) {

                const oldMat = child.material;

                child.material = new THREE.MeshBasicMaterial( {

                    name: oldMat.name,

                    map : oldMat.map,

                    color: oldMat.color,

                    skinning: true,

                    side: THREE.DoubleSide

                });

            }



        });

        //object.scale.set(1,1,1);

        object.rotation.y += THREE.Math.degToRad(180);

        playerModel.model = object;

        playerModel.animation = object.animations[0];

    });

}



function init(){

  document.getElementById('loading').style.display = 'none';



    if (is_touch_device()){

        onMobile = true;

    }

    LEVEL.innerHTML = "Level "+level;

    BTN_SOUND.style.visibility = "visible";

    INSTRUCTION.style.visibility = "visible";

    GAME_UI.style.visibility = "visible";

    renderer = new THREE.WebGLRenderer({canvas: CANVAS, antialias: true,});

    renderer.setPixelRatio( 0.8 );



    renderer.setSize( window.innerWidth, window.innerHeight );

    renderer.outputEncoding = THREE.sRGBEncoding;

    //renderer.shadowMapEnabled = true;



    camera = new THREE.PerspectiveCamera( 45, window.innerWidth / window.innerHeight, 1, 14000 );

    camera.position.set(0, 400, 400);

    camera.lookAt(0,140,0);

    camera.add( Sound.listener );



    scene = new THREE.Scene();

    scene.background = new THREE.Color( 0xBFB1FF ).convertSRGBToLinear();



    window.addEventListener( 'resize', onWindowResize, false );

    document.addEventListener('touchstart', touchStart, false);

    document.addEventListener('touchend', touchEnd, false);

    document.addEventListener('touchmove', touchMoved, false);



    document.addEventListener('mousemove', mouseMoved, false);

    document.addEventListener('mousedown', mouseDown, false);

    document.addEventListener('mouseup', mouseUp, false);

    setUpGame();

    animate();

}



function setUpGame() {

    LaggedAPI.init('high_heelstw_gintigny','lagdevaF3001');



    spawner = new Spawner();

    player = new Player();

}



function Player() {

    var self = {

        group: null,

        model: null,

        mixer: null,

        horizontalSpeed: 2,

        worldPos: new THREE.Vector3(),

        heelHeight: 0,

        spawnTimer: 0,

        slide: 0,

        pcd: 0,

        safeCD: 0,

    }

    self.init = function(){

        // model

        self.group = new THREE.Object3D();

        scene.add(self.group);



        self.model = THREE.SkeletonUtils.clone(playerModel.model);

        self.model.position.set(0, 0, 0);

        self.group.add(self.model);



        self.heelL = BaseModel.heel.fbx.clone();

        self.heelL.traverse(function ( child ) {

            if ( child instanceof THREE.Mesh ) {

                const oldMat = child.material;

                child.material = new THREE.MeshBasicMaterial( { color: oldMat.color, });

            }

        });

        self.heelL.rotation.z += THREE.Math.degToRad(180);

        self.model.children[1].children[0].children[3].children[1].children[0].add(self.heelL);

        self.heelL.position.y += 60;



        self.heelR = BaseModel.heel.fbx.clone();

        self.heelR.traverse(function ( child ) {

            if ( child instanceof THREE.Mesh ) {

                const oldMat = child.material;

                child.material = new THREE.MeshBasicMaterial( { color: oldMat.color, });

            }

        });

        self.heelR.rotation.z += THREE.Math.degToRad(180);

        self.model.children[1].children[0].children[1].children[1].children[0].add(self.heelR);

        self.heelR.position.y += 60;



        self.mixer = new THREE.AnimationMixer(self.model);

        const firstClip = playerModel.animation;

        self.walk = self.mixer.clipAction(firstClip);

        const SecondClip = Anims.die.animation;

        self.die = self.mixer.clipAction(SecondClip);

        const ThirdClip = Anims.slide.animation;

        self.slideA = self.mixer.clipAction(ThirdClip);

        self.slideA.timeScale = 0;

        const fourthClip = Anims.dance.animation;

        self.dance = self.mixer.clipAction(fourthClip);

        self.walk.play();



        //Shadow

        self.shadow = new THREE.Mesh( new THREE.CircleGeometry(75, 5, 15), new THREE.MeshBasicMaterial({ map: Textures.shadow.texture, transparent: true, opacity: 0.16 }));

        self.shadow.rotation.x = -1.57;

        self.group.add(self.shadow);

        self.shadow.position.z = 40;

        self.shadow.position.y = 1;



        self.box = new THREE.Mesh(new THREE.BoxBufferGeometry(), new THREE.MeshPhongMaterial({color: 0x30ab78, visible: false}));



        self.box.scale.set(20, 1000, 20);

        self.box.position.y = -305;

        self.group.add(self.box);

        self.boundingBox = new THREE.BoxHelper(self.box, 0x00ff00);

        self.box3 = new THREE.Box3().setFromObject(self.box);



        self.HboundingBox = new THREE.BoxHelper(self.heelL, 0x00ff00);

        self.Hbox3 = new THREE.Box3().setFromObject(self.heelL);

    }

    self.checkCollision = function(dt){

        // set correct height base don heel

        if (self.heelHeight < 0) self.heelHeight = 0;

        self.heelL.scale.y = THREE.Math.lerp(self.heelL.scale.y, self.heelHeight, 4*dt);

        self.heelR.scale.y =  THREE.Math.lerp(self.heelR.scale.y, self.heelHeight, 4*dt);

        self.group.position.y = 4.5*self.heelL.scale.y;

        self.shadow.position.y = 1+(-4*self.heelL.scale.y);



        if (self.slide == 1){

            spawner.speed = 550;

            self.group.position.y = 0;

            self.shadow.position.y = 1000;

            if (!self.slideA.isRunning()){

                self.mixer.stopAllAction();

                self.slideA.fadeIn(0.2);

                self.slideA.play();

            }

            self.pcd ++;

            if (self.pcd%15 == 0){

                new explosion(new THREE.Vector3(self.group.position.x -100, 0, self.group.position.z));

                new explosion(new THREE.Vector3(self.group.position.x +100, 0, self.group.position.z));

            }

        }



        if (!self.walk.isRunning() && self.slide == 0 && !gameOver){

            self.mixer.stopAllAction();

            self.walk.fadeIn(0.2);

            self.walk.play();

            spawner.speed = 400;

        }

        self.slide = 0;

        for (let i in collisionArray){

            let child = collisionArray[i];

            collision = self.box3.intersectsBox(child);

            if (collision){

                if (child.pickup){

                    score += 10;

                    SCORE.innerHTML = score;

                    scoreFX();

                    INSTRUCTION.style.visibility = "hidden";

                    collisionArray[i].destroy = true;

                    self.heelHeight += 15;

                    new explosion(new THREE.Vector3(self.group.position.x, self.group.position.y-10, self.group.position.z));

                    new explosion(new THREE.Vector3(self.group.position.x, self.group.position.y-10, self.group.position.z));

                    if (Sound.add.sound.isPlaying)

                        Sound.add.sound.stop();

                    Sound.add.sound.play();

                }

                else if (child.end && !gameOver && self.heelHeight == 0  && self.safeCD < 0){

                    gameOverFunction(0);

                    Sound.die.sound.play();

                }

                else if (child.win && !gameOver && self.heelHeight == 0){

                    gameOverFunction(1);

                    score += score*child.multiplier;

                    SCORE.innerHTML = score;

                    scoreFX();

                    Sound.complete.sound.play();

                }

                else if (child.rail){

                    self.slide = 1;

                    Sound.slide.sound.play();

                }

            }

            self.safeCD --;

            collision2 = self.Hbox3.intersectsBox(child);

            if (collision2){

                if (child.end && self.safeCD<0){

                    self.safeCD = 20;

                    self.heelHeight -= 11;

                    new explosion(new THREE.Vector3(self.group.position.x, self.group.position.y-10, self.group.position.z));

                    new explosion(new THREE.Vector3(self.group.position.x, self.group.position.y-10, self.group.position.z));

                    child.end = false;

                    Sound.remove.sound.play();

                }

                else if (child.end2){

                    spawner.speed = 700;

                    self.heelHeight -= 9;

                    child.end2 = false;

                    Sound.remove.sound.play();

                }



            }



        }

    }

    self.update = function(delta) {

        self.mixer.update(delta);

        if (move.movementX > 200)

            move.movementX = 200;

        if (move.movementX < -200)

            move.movementX = -200;

        if (move.movementX > 20 && self.group.position.x < 145 && !gameOver && !self.slide){

            self.group.translateX((self.horizontalSpeed*move.movementX) * delta);

        }

        else if (move.movementX < -20 && self.group.position.x > -145 && !gameOver && !self.slide){

            self.group.translateX((self.horizontalSpeed*move.movementX) * delta);

        }





        self.group.getWorldPosition(self.worldPos);

        self.worldPos.z += 700;

        if (gameOver)

            self.worldPos.z += 400;

        self.worldPos.y += 400;

        camera.position.lerp(self.worldPos, 2*delta);

        self.tmpPos = self.group.position.clone();

        self.tmpPos.y += 150;

        camera.lookAt(self.tmpPos);



        // update bounding box

        self.boundingBox.setFromObject(self.box);

        self.box3.setFromObject(self.box);

        self.HboundingBox.setFromObject(self.heelL);

        self.Hbox3.setFromObject(self.heelL);

        self.spawnTimer ++;

        if (self.spawnTimer>10){

            self.checkCollision(delta);

        }

    }



    self.init();

    updateArray.push(self);

    return self;

}



function Spawner() {

    var self = {

        group: null,

        groundArray: [],

        cubeArray: [],

        pickupArray: [],

        nextZ: 0,

        endSensor: null,

        speed: 400,

        colorArray: [0xce1212, 0xff5e78, 0xffcc29, 0xf58634, 0x845ec2, 0x81b214, 0x2d6187, 0x28abb9, 0x8675a9, 0xefbbcf],

        spriteArray: [],

        endArray: [],

        railArray: [],

    }

    self.init = function(){

        self.spawnGround(BaseModel.level0.fbx.clone());

        let totalBlocks = 1+Math.floor(level/3);

        for (let i = 1; i <= totalBlocks; i ++){

            let r = rand(1,4);

            self.spawnGround(eval("BaseModel.level"+r+".fbx.clone()"));

        }

        self.spawnEnd();

    }

    self.spawnGround = function(type){

        let pos = {x: 0, y: 0, z: self.nextZ};

        // ground

        self.group = new THREE.Object3D();

        scene.add(self.group);

        self.groundArray.push(self.group);



        self.model = type;

        self.group.position.set(pos.x,pos.y,pos.z);

        self.group.add(self.model);

        self.model.traverse(function ( child ) {

            if ( child instanceof THREE.Mesh ) {

                const oldMat = child.material;

                child.material = new THREE.MeshBasicMaterial( { color: oldMat.color });

                // bounding box

                if (oldMat.name == "heels"){

                    self.pickupArray.push(child);

                    child.cube = new THREE.Mesh( new THREE.BoxBufferGeometry( 50, 1000, 50 ), new THREE.MeshBasicMaterial( { color: 0xffaa00, visible: false} ) );

                    child.cube.position.copy(child.position);

                    self.group.add(child.cube);

                    child.boundingBox = new THREE.BoxHelper(child.cube, 0x00ff00);

                    child.box3 = new THREE.Box3().setFromObject(child.cube);

                    child.box3.pickup = true;

                    child.box3.uuid = child.uuid;

                    collisionArray.push(child.box3);

                }

                else if (oldMat.name == "Cube"){

                    self.cubeArray.push(child);

                    child.cube = new THREE.Mesh( new THREE.BoxBufferGeometry( 60, 60, 60 ), new THREE.MeshBasicMaterial( { color: 0xffaa00,visible: false} ) );

                    child.cube.position.copy(child.position);

                    self.group.add(child.cube);

                    child.boundingBox = new THREE.BoxHelper(child.cube, 0x00ff00);

                    child.box3 = new THREE.Box3().setFromObject(child.cube);

                    child.box3.end = true;

                    collisionArray.push(child.box3);

                }

                else if (oldMat.name == "rail"){

                    child.cube = new THREE.Mesh( new THREE.BoxBufferGeometry( 300, 200, 1300 ), new THREE.MeshBasicMaterial( { color: 0xffaa00,visible: false} ) );

                    child.cube.position.copy(child.position);

                    self.group.add(child.cube);

                    child.boundingBox = new THREE.BoxHelper(child.cube, 0x00ff00);

                    child.box3 = new THREE.Box3().setFromObject(child.cube);

                    child.box3.rail = true;

                    collisionArray.push(child.box3);

                    self.railArray.push(child);

                }

            }

        });

        self.nextZ -= 1420

    }

    self.spawnEnd = function(){

        let posZ = self.nextZ+600;

        let posY = 0;

        let col = 0;



        for (let i = 0; i < 20; i++){

            let b1 = new THREE.Mesh( new THREE.BoxBufferGeometry( 300, 20, 220 ), new THREE.MeshBasicMaterial( { color: self.colorArray[col]} ) );

            b1.position.z = posZ;

            b1.position.y += posY;

            scene.add( b1 );

            self.groundArray.push(b1);



            b1.boundingBox = new THREE.BoxHelper(b1, 0x00ff00);

            b1.box3 = new THREE.Box3().setFromObject(b1);

            b1.box3.end2 = true;

            b1.box3.win = true;

            b1.box3.multiplier = i+1;

            self.endArray.push(b1);

            collisionArray.push(b1.box3);



            let tt = 'x'+(i+1);

            const ctx = document.createElement('canvas').getContext('2d');

            const borderSize = 2;

            const font =  `700 30px Arial`;

            ctx.font = font;

            // measure how long the name will be

            const textWidth = ctx.measureText(tt).width;

            const doubleBorderSize = borderSize * 2;

            const width = 50 + doubleBorderSize;

            const height = 30 + doubleBorderSize;

            ctx.canvas.width = width;

            ctx.canvas.height = height;

            ctx.font = font;



            // need to set font again after resizing canvas

            ctx.textBaseline = 'middle';

            ctx.textAlign = 'center';

            // scale to fit but don't stretch

            const scaleFactor = Math.min(1, 50 / textWidth);

            ctx.translate(width / 2, height / 2);

            ctx.scale(scaleFactor, 1);

            ctx.fillStyle = '#FFFFFF';

            ctx.strokeStyle = '#000000';

            ctx.lineWidth = 3;

            ctx.strokeText(tt, 0, 0);

            ctx.fillText(tt, 0, 0);



            const texture = new THREE.CanvasTexture(ctx.canvas);

            texture.encoding = THREE.sRGBEncoding;

            texture.minFilter = THREE.LinearFilter;

            texture.wrapS = THREE.ClampToEdgeWrapping;

            texture.wrapT = THREE.ClampToEdgeWrapping;

            let spriteMaterial = new THREE.SpriteMaterial({map:texture});

            let nameSprite = new THREE.Sprite(spriteMaterial);

            scene.add(nameSprite);

            nameSprite.scale.x =  100;

            nameSprite.scale.y =  50;

            nameSprite.position.y = 40;

            b1.add(nameSprite);



            posZ -= 220;

            //posY += 20;

            col ++;

            if (col > 9){

                col = 0

            }

        }

    }

    self.update = function(dt){

        for (let i in self.railArray){

            self.railArray[i].boundingBox.setFromObject(self.railArray[i].cube);

            self.railArray[i].box3.setFromObject(self.railArray[i].cube);

        }

        for (let i in self.endArray){

            self.endArray[i].boundingBox.setFromObject(self.endArray[i]);

            self.endArray[i].box3.setFromObject(self.endArray[i]);

        }

        for (let i in self.groundArray){

            self.groundArray[i].position.z += self.speed*dt;

        }

        for (let i in self.pickupArray){

            self.pickupArray[i].boundingBox.setFromObject(self.pickupArray[i].cube);

            self.pickupArray[i].box3.setFromObject(self.pickupArray[i].cube);

            for (let a in collisionArray){

                if (collisionArray[a].destroy){

                    if (collisionArray[a].uuid == self.pickupArray[i].box3.uuid){

                        console.log("remove");

                        self.pickupArray[i].visible = false;

                        collisionArray.splice(a,1);

                    }

                }

            }

        }

        for (let i in self.cubeArray){

            self.cubeArray[i].boundingBox.setFromObject(self.cubeArray[i].cube);

            self.cubeArray[i].box3.setFromObject(self.cubeArray[i].cube);

        }

    }

    self.init();

    updateArray.push(self);

    return self;

}



function gameOverFunction(type) {

    gameOver = true;

    spawner.speed = 0;

    let wait = 1500;



if (type != 1){

    var boardinfo={};

    boardinfo.score=score;

    boardinfo.board='high_heelstw_hsbdhyg';

    LaggedAPI.Scores.save(boardinfo, function(response) {

    if(response.success) {

    console.log('high score saved')

    }else {

    console.log(response.errormsg);

    }

    });

}

    LaggedAPI.APIAds.show('interstitial','high-heels-2','high-heels-2-game.png',function(response) {

    if(response.success) {

    console.log('ad done');

    }else {

    console.log('ad error, continue');

    }

    });





    if (type == 1){

        GO_MESSAGE.innerHTML = "Level Complete!";

        BTN_RESTART.style.display = "none";

        BTN_NEXT.style.display = "inline-block";



        callConfetti();





        wait += 3000;

        player.mixer.stopAllAction();

        player.dance.fadeIn(0.2);

        player.dance.play();

    }

    else {

        BTN_RESTART.style.display = "inline-block";

        BTN_NEXT.style.display = "none";

        player.mixer.stopAllAction();

        player.die.fadeIn(0.2);

        player.die.play();

        GO_MESSAGE.innerHTML = "Try Again..!";

    }



    setTimeout(function(){

        GAMEOVER_UI.style.visibility = "visible";

    },wait)

}



function ScoreText(spawnPos) {

    var self = {

        timer: 0,

    }

    self.init = function(){

        if (Sound.score.sound.isPlaying)

            Sound.score.sound.stop();

        Sound.score.sound.play();

        let spriteMaterial = new THREE.SpriteMaterial({map:Textures.score.texture});

        self.sprite = new THREE.Sprite(spriteMaterial);

        scene.add(self.sprite);

        self.sprite.scale.set(25,30);

        spawnPos.y += 50;

        self.sprite.position.copy(spawnPos);

    }

    self.update = setInterval(function(){

        self.sprite.position.y += 3.5;

        self.timer ++;

        if (self.timer > 40){

            scene.remove(self.sprite);

            clearInterval(self.update);

        }

    },1000/60);



    self.init();

    return self;

}



function btnContinue() {

    Sound.button.sound.play();

    GAMEOVER_UI.style.visibility = "hidden";

    for( var i = scene.children.length - 1; i >= 0; i--)

        scene.remove(scene.children[i]);

    updateArray = [];

    player = null;

    spawner = null;

    collisionArray = [];

    level++;

    gameOver = false;

    particleArray = [];

    heels = [];

    setUpGame();

    LEVEL.innerHTML = "Level "+level;

    camera.position.set(0, 400, 400);

    camera.lookAt(0,140,0);

    try{

    localStorage.setItem("highHeelDash",level);

    }catch(e){

      console.log(e);

    }

}



function btnRestart() {

    Sound.button.sound.play();

    GAMEOVER_UI.style.visibility = "hidden";

    for( var i = scene.children.length - 1; i >= 0; i--)

        scene.remove(scene.children[i]);

    updateArray = [];

    player = null;

    spawner = null;

    collisionArray = [];

    gameOver = false;

    particleArray = [];

    heels = [];

    setUpGame();

    LEVEL.innerHTML = "Level "+level;

    camera.position.set(0, 400, 400);

    camera.lookAt(0,140,0);

    score = 0;

    SCORE.innerHTML = score;

}



function btnSound() {

    Sound.button.sound.play();

    if (BTN_SOUND.style.opacity == 1){

        BTN_SOUND.style.opacity = 0.5;

        Sound.listener.setMasterVolume(0);

    }

    else {

        BTN_SOUND.style.opacity = 1;

        Sound.listener.setMasterVolume(1);

    }

}



function onWindowResize() {

    camera.aspect = window.innerWidth / window.innerHeight;

    camera.updateProjectionMatrix();



    renderer.setSize( window.innerWidth, window.innerHeight );

}



// HELPER FUNCTIONS

function rand(min, max) {

    min = Math.ceil(min);

    max = Math.floor(max);

    return Math.floor(Math.random() * (max - min + 1)) + min; //The maximum is inclusive and the minimum is inclusive

}



// CONTROLS

var move = {

    movementX: null,

    lastX: null,

};



function touchStart(event) {

    let touch = event.changedTouches[0];

    move.lastX = touch.pageX;

     if (!Sound.music.sound.isPlaying){

        Sound.music.sound.play();

    }

}



function touchEnd(event) {

    move.lastX = null;

    move.movementX = 0;

}



function touchMoved(event) {

    let touch = event.changedTouches[0];

    if (move.lastX){

        move.movementX = touch.pageX - move.lastX;

    }

}



function mouseDown(event) {

   move.lastX = event.pageX;

    if (!Sound.music.sound.isPlaying){

        Sound.music.sound.play();

    }

}



function mouseUp(event) {

    move.lastX = null;

    move.movementX = 0;

}



function mouseMoved(event) {

    if (move.lastX){

        move.movementX = event.pageX - move.lastX;

    }

}



// ACTUAL GAME

function animate(){

    requestAnimationFrame( animate );

    var delta = clock.getDelta();

    if (delta > 2){

        delta = 0;

    }



    for (let i in updateArray){

        updateArray[i].update(delta);

    }

    for (let i in particleArray){

        particleArray[i].update(delta);

    }

    showLandscapeMessage();

    renderer.render( scene, camera );

}



function callConfetti() {

    var duration = 2 * 50;

    var end = Date.now() + duration;



    (function frame() {

        // launch a few confetti from the left edge

        confetti({

            particleCount: 7,

            angle: 60,

            spread: 55,

            origin: { x: 0 }

        });

        // and launch a few from the right edge

        confetti({

            particleCount: 7,

            angle: 120,

            spread: 55,

            origin: { x: 1 }

        });



        // keep going until we are out of time

        if (Date.now() < end) {

            requestAnimationFrame(frame);

        }

    }());



    confetti({

        particleCount: 150,

        spread: 180

    });

}



function scoreFX() {

    SCORE.innerHTML = score;

    SCORE.classList.add('animate__animated', 'animate__heartBeat');

    SCORE.addEventListener('animationend', removeMenu);

    function removeMenu() {

        SCORE.removeEventListener('animationend', removeMenu);

        SCORE.classList.remove('animate__animated', 'animate__heartBeat');



    }

}



function explosion(spawnPos){

    var self = {

        particles: [],

        max: 4,

        mesh: null,

        index: null,

    }

    self.init = function() {

        let geo = new THREE.Geometry();

        for(let i=0; i<self.max; i++) {

            let particle = {

                position: new THREE.Vector3(

                      0,

                      0,

                      0),

                velocity: new THREE.Vector3(

                      rand(-1, 1),

                      rand(4,6),

                      rand(-1, 1)),

                acceleration: new THREE.Vector3(0, -0.3, 0),

            }

            self.particles.push(particle)

            geo.vertices.push(particle.position)

        }

        var mat = new THREE.PointsMaterial({color:0xFFFFFF,size: 50, map: Textures.explosion.texture, opacity: 0.8, transparent: true, })

        self.mesh = new THREE.Points(geo,mat)

        self.mesh.position.copy(spawnPos);

        scene.add(self.mesh);

    }

    self.update = function(){

        self.particles.forEach(p => {

            p.velocity.add(p.acceleration);

            p.position.add(p.velocity);

            self.mesh.material.size -= 0.3;

        })

        self.mesh.geometry.verticesNeedUpdate = true;

        if (self.mesh.material.size < 0){

            scene.remove(self.mesh);

            for (let i in particleArray){

                if (particleArray[i].mesh.uuid == self.mesh.uuid)

                    particleArray.splice(i,1);

            }

        }

    }



    self.init();

    particleArray.push(self);

    return self;

}



function showLandscapeMessage() {

    if (onMobile) {

        if (window.innerWidth > window.innerHeight){

            ROTATE_MSG.style.visibility = "visible";

        }

        else if (ROTATE_MSG.style.visibility == "visible"){

            ROTATE_MSG.style.visibility = "hidden";

        }

    }

}



function is_touch_device() {

  try {

    document.createEvent("TouchEvent");

    return true;

  } catch (e) {

    return false;

  }

}



preload();



</script>

</body>

</html>

