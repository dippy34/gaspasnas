<!DOCTYPE html>
<html lang="en" class="sl-theme-dark gaming-theme">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>Advanced Calculator</title>
    <meta name="description" content="Advanced Calculator with Gaming Theme" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link rel="icon" type="image/x-icon" href="/nova-favicon.ico">
    
    <!-- Gaming Theme CSS -->
    <link rel="stylesheet" href="/css/gaming-theme.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            background: var(--gaming-bg);
            color: var(--gaming-text);
            font-family: 'Rajdhani', sans-serif;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 1rem;
            overflow-x: hidden;
        }

        .calculator-container {
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid var(--gaming-border);
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 
                0 0 30px rgba(0, 255, 0, 0.2),
                inset 0 0 20px rgba(0, 0, 0, 0.8);
            max-width: 500px;
            width: 100%;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .calculator-container.fullscreen {
            max-width: none;
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
            padding: 1rem;
            border-radius: 0;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
        }

        body.fullscreen-mode {
            padding: 0;
            overflow: hidden;
        }

        .calculator-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 255, 0, 0.05), transparent);
            animation: scanline 3s linear infinite;
            pointer-events: none;
        }

        @keyframes scanline {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .calculator-title {
            font-family: 'Orbitron', monospace;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--gaming-accent);
            text-align: center;
            margin-bottom: 1.5rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: 0 0 10px var(--gaming-glow);
        }

        .calculator-container.fullscreen .calculator-title {
            font-size: 1.5rem;
            margin-bottom: 1rem;
        }

        .display-container {
            margin-bottom: 1.5rem;
            position: relative;
        }

        .calculator-container.fullscreen .display-container {
            margin-bottom: 1rem;
        }

        .display-input {
            width: 100%;
            padding: 1.5rem 1rem;
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid var(--gaming-border);
            border-radius: 10px;
            color: var(--gaming-text);
            font-family: 'Rajdhani', sans-serif;
            font-size: 1.5rem;
            font-weight: 600;
            text-align: right;
            box-shadow: 
                inset 0 2px 10px rgba(0, 0, 0, 0.8),
                0 0 15px rgba(0, 255, 0, 0.1);
            transition: all 0.3s ease;
            outline: none;
        }

        .calculator-container.fullscreen .display-input {
            font-size: 1.5rem;
            padding: 1rem 1rem;
        }

        .display-input:focus {
            border-color: var(--gaming-accent);
            box-shadow: 
                inset 0 2px 10px rgba(0, 0, 0, 0.8),
                0 0 25px var(--gaming-glow);
        }

        .history-display {
            min-height: 2rem;
            padding: 0.5rem 1rem;
            background: rgba(0, 0, 0, 0.6);
            border: 1px solid var(--gaming-border);
            border-radius: 8px;
            margin-bottom: 0.5rem;
            color: var(--gaming-text-dim);
            font-family: 'Rajdhani', sans-serif;
            font-size: 0.9rem;
            text-align: right;
            word-wrap: break-word;
            opacity: 0.8;
        }

        .calculator-container.fullscreen .history-display {
            font-size: 0.9rem;
            padding: 0.5rem 1rem;
            min-height: 1.5rem;
            margin-bottom: 0.4rem;
        }

        .buttons-grid {
            display: grid;
            gap: 0.75rem;
        }

        .basic-buttons {
            grid-template-columns: repeat(4, 1fr);
        }

        .basic-buttons:not(.active) {
            display: none;
        }

        .advanced-buttons {
            display: none;
            grid-template-columns: repeat(6, 1fr);
            gap: 0.4rem;
            flex: 1;
            overflow: visible;
            align-content: start;
        }

        .calculator-container.fullscreen .advanced-buttons {
            grid-template-columns: repeat(8, 1fr);
            gap: 0.4rem;
        }

        .advanced-buttons.active {
            display: grid;
        }

        .function-group {
            grid-column: span 6;
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 0.4rem;
            margin-bottom: 0.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid rgba(0, 255, 0, 0.15);
        }

        .calculator-container.fullscreen .function-group {
            grid-column: span 8;
            grid-template-columns: repeat(8, 1fr);
            gap: 0.4rem;
            margin-bottom: 0.4rem;
            padding-bottom: 0.4rem;
        }

        .group-label {
            grid-column: 1 / -1;
            font-family: 'Orbitron', monospace;
            font-size: 0.7rem;
            color: var(--gaming-accent);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 0.35rem;
            text-shadow: 0 0 8px var(--gaming-glow);
            padding-bottom: 0.2rem;
            border-bottom: 1px solid rgba(0, 255, 0, 0.1);
        }

        .calc-button {
            padding: 1rem;
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid var(--gaming-border);
            border-radius: 8px;
            color: var(--gaming-text);
            font-family: 'Rajdhani', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.6);
        }

        .calculator-container.fullscreen .calc-button {
            padding: 0.65rem;
            font-size: 0.85rem;
        }

        .calc-button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(0, 255, 0, 0.2);
            transform: translate(-50%, -50%);
            transition: width 0.3s ease, height 0.3s ease;
        }

        .calc-button:active::before {
            width: 300px;
            height: 300px;
        }

        .calc-button:hover {
            background: rgba(0, 255, 0, 0.15);
            border-color: var(--gaming-accent);
            box-shadow: 0 0 20px var(--gaming-glow);
            transform: translateY(-2px);
        }

        .calc-button:active {
            transform: translateY(0);
        }

        .calc-button.operator {
            background: rgba(0, 255, 0, 0.1);
            border-color: rgba(0, 255, 0, 0.4);
            color: var(--gaming-accent);
        }

        .calc-button.operator:hover {
            background: rgba(0, 255, 0, 0.2);
            box-shadow: 0 0 25px var(--gaming-glow);
        }

        .calc-button.function {
            background: rgba(0, 200, 255, 0.1);
            border-color: rgba(0, 200, 255, 0.4);
            color: #00c8ff;
            font-size: 0.9rem;
        }

        .calculator-container.fullscreen .calc-button.function {
            font-size: 0.8rem;
        }

        .calc-button.function:hover {
            background: rgba(0, 200, 255, 0.2);
            box-shadow: 0 0 25px rgba(0, 200, 255, 0.5);
        }

        .calc-button.equals {
            background: rgba(0, 255, 0, 0.2);
            border-color: var(--gaming-accent);
            color: var(--gaming-accent);
            font-weight: 700;
        }

        .calc-button.equals:hover {
            background: rgba(0, 255, 0, 0.3);
            box-shadow: 0 0 30px var(--gaming-glow);
        }

        .calc-button.clear {
            background: rgba(255, 0, 0, 0.1);
            border-color: rgba(255, 0, 0, 0.4);
            color: #ff4444;
        }

        .calc-button.clear:hover {
            background: rgba(255, 0, 0, 0.2);
            box-shadow: 0 0 25px rgba(255, 0, 0, 0.5);
        }

        .mode-toggle {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            justify-content: center;
        }

        .calculator-container.fullscreen .mode-toggle {
            margin-bottom: 1rem;
        }

        .mode-button {
            padding: 0.5rem 1rem;
            background: rgba(0, 0, 0, 0.6);
            border: 1px solid var(--gaming-border);
            border-radius: 6px;
            color: var(--gaming-text-dim);
            font-family: 'Rajdhani', sans-serif;
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
        }

        .calculator-container.fullscreen .mode-button {
            padding: 0.5rem 1rem;
            font-size: 0.85rem;
        }

        .mode-button.active {
            background: rgba(0, 255, 0, 0.15);
            border-color: var(--gaming-accent);
            color: var(--gaming-accent);
            box-shadow: 0 0 15px var(--gaming-glow);
        }

        .mode-button:hover:not(.active) {
            border-color: var(--gaming-border);
            color: var(--gaming-text);
        }

        @media (max-width: 600px) {
            .calculator-container.fullscreen {
                padding: 1rem;
            }

            .calculator-container {
                padding: 1.5rem;
            }

            .calc-button {
                padding: 0.75rem;
                font-size: 0.9rem;
            }

            .calc-button.function {
                font-size: 0.75rem;
            }

            .display-input {
                font-size: 1.25rem;
                padding: 1.25rem 0.75rem;
            }

            .advanced-buttons {
                grid-template-columns: repeat(4, 1fr);
            }

            .function-group {
                grid-column: span 4;
                grid-template-columns: repeat(4, 1fr);
            }
        }
    </style>
</head>

<body>
    <div class="calculator-container" id="calcContainer">
        <h1 class="calculator-title">Calculator</h1>
        
        <div class="mode-toggle">
            <button class="mode-button active" onclick="setMode('basic', this)">Basic</button>
            <button class="mode-button" onclick="setMode('advanced', this)">Advanced</button>
        </div>

        <div class="display-container">
            <div class="history-display" id="history"></div>
            <input type="text" class="display-input" id="display" readonly placeholder="0" />
        </div>

        <!-- Basic Calculator (Simple arithmetic only) -->
        <div class="buttons-grid basic-buttons active">
            <button class="calc-button clear" onclick="clearAll()">AC</button>
            <button class="calc-button clear" onclick="clearEntry()">CE</button>
            <button class="calc-button operator" onclick="deleteLast()">⌫</button>
            <button class="calc-button operator" onclick="appendToDisplay('/')">÷</button>
            
            <button class="calc-button" onclick="appendToDisplay('7')">7</button>
            <button class="calc-button" onclick="appendToDisplay('8')">8</button>
            <button class="calc-button" onclick="appendToDisplay('9')">9</button>
            <button class="calc-button operator" onclick="appendToDisplay('*')">×</button>
            
            <button class="calc-button" onclick="appendToDisplay('4')">4</button>
            <button class="calc-button" onclick="appendToDisplay('5')">5</button>
            <button class="calc-button" onclick="appendToDisplay('6')">6</button>
            <button class="calc-button operator" onclick="appendToDisplay('-')">-</button>
            
            <button class="calc-button" onclick="appendToDisplay('1')">1</button>
            <button class="calc-button" onclick="appendToDisplay('2')">2</button>
            <button class="calc-button" onclick="appendToDisplay('3')">3</button>
            <button class="calc-button operator" onclick="appendToDisplay('+')">+</button>
            
            <button class="calc-button" onclick="appendToDisplay('0')" style="grid-column: span 2;">0</button>
            <button class="calc-button" onclick="appendToDisplay('.')">.</button>
            <button class="calc-button equals" onclick="calculate()">=</button>
        </div>

        <!-- Advanced Calculator (Organized by function groups) -->
        <div class="buttons-grid advanced-buttons">
            <!-- Control Buttons -->
            <button class="calc-button clear" onclick="clearAll()">AC</button>
            <button class="calc-button clear" onclick="clearEntry()">CE</button>
            <button class="calc-button operator" onclick="deleteLast()">⌫</button>
            <button class="calc-button operator" onclick="appendToDisplay('(')">(</button>
            <button class="calc-button operator" onclick="appendToDisplay(')')">)</button>
            <button class="calc-button operator" onclick="appendToDisplay('^')">x^y</button>

            <!-- Trigonometric Functions -->
            <div class="function-group">
                <div class="group-label">Trigonometric Functions</div>
                <button class="calc-button function" onclick="appendFunction('sin(')">sin</button>
                <button class="calc-button function" onclick="appendFunction('cos(')">cos</button>
                <button class="calc-button function" onclick="appendFunction('tan(')">tan</button>
                <button class="calc-button function" onclick="appendFunction('sin⁻¹(')">sin⁻¹</button>
                <button class="calc-button function" onclick="appendFunction('cos⁻¹(')">cos⁻¹</button>
                <button class="calc-button function" onclick="appendFunction('tan⁻¹(')">tan⁻¹</button>
            </div>

            <!-- Logarithmic Functions -->
            <div class="function-group">
                <div class="group-label">Logarithmic Functions</div>
                <button class="calc-button function" onclick="appendFunction('log(')">log</button>
                <button class="calc-button function" onclick="appendFunction('ln(')">ln</button>
                <button class="calc-button function" onclick="appendFunction('log₁₀(')">log₁₀</button>
                <button class="calc-button function" onclick="appendFunction('10^(')">10^x</button>
                <button class="calc-button function" onclick="appendFunction('e^(')">e^x</button>
            </div>

            <!-- Power & Root Functions -->
            <div class="function-group">
                <div class="group-label">Power & Root</div>
                <button class="calc-button function" onclick="appendFunction('sqrt(')">√</button>
                <button class="calc-button function" onclick="appendToDisplay('!')">n!</button>
                <button class="calc-button function" onclick="appendFunction('abs(')">abs</button>
            </div>

            <!-- Constants -->
            <div class="function-group" style="border-bottom: none; margin-bottom: 0; padding-bottom: 0;">
                <div class="group-label">Constants</div>
                <button class="calc-button function" onclick="appendConstant('Math.PI')">π</button>
                <button class="calc-button function" onclick="appendConstant('Math.E')">e</button>
                <button class="calc-button" onclick="appendToDisplay('7')">7</button>
                <button class="calc-button" onclick="appendToDisplay('8')">8</button>
                <button class="calc-button" onclick="appendToDisplay('9')">9</button>
                <button class="calc-button operator" onclick="appendToDisplay('/')">÷</button>
                <button class="calc-button" onclick="appendToDisplay('4')">4</button>
                <button class="calc-button" onclick="appendToDisplay('5')">5</button>
                <button class="calc-button" onclick="appendToDisplay('6')">6</button>
                <button class="calc-button operator" onclick="appendToDisplay('*')">×</button>
                <button class="calc-button" onclick="appendToDisplay('1')">1</button>
                <button class="calc-button" onclick="appendToDisplay('2')">2</button>
                <button class="calc-button" onclick="appendToDisplay('3')">3</button>
                <button class="calc-button operator" onclick="appendToDisplay('-')">-</button>
                <button class="calc-button" onclick="appendToDisplay('0')">0</button>
                <button class="calc-button" onclick="appendToDisplay('.')">.</button>
                <button class="calc-button operator" onclick="appendToDisplay('+')">+</button>
                <button class="calc-button equals" onclick="calculate()">=</button>
            </div>
        </div>
    </div>

    <script>
        const display = document.getElementById('display');
        const historyDisplay = document.getElementById('history');
        const calcContainer = document.getElementById('calcContainer');
        let currentInput = '';
        let shouldResetDisplay = false;

        function appendToDisplay(value) {
            if (shouldResetDisplay) {
                display.value = '';
                shouldResetDisplay = false;
            }
            
            display.value += value;
            currentInput = display.value;
        }

        function appendFunction(func) {
            if (shouldResetDisplay) {
                display.value = '';
                shouldResetDisplay = false;
            }
            
            // Convert abs( to display format
            if (func === 'abs(') {
                display.value += 'abs(';
            } else {
                display.value += func;
            }
            currentInput = display.value;
        }

        function appendConstant(constant) {
            if (shouldResetDisplay) {
                display.value = '';
                shouldResetDisplay = false;
            }
            
            if (constant === 'Math.PI') {
                display.value += 'π';
            } else if (constant === 'Math.E') {
                display.value += 'e';
            }
            
            currentInput = display.value;
        }

        function clearAll() {
            display.value = '';
            historyDisplay.textContent = '';
            currentInput = '';
            shouldResetDisplay = false;
        }

        function clearEntry() {
            display.value = '';
            currentInput = '';
            shouldResetDisplay = false;
        }

        function deleteLast() {
            display.value = display.value.slice(0, -1);
            currentInput = display.value;
        }

        function setMode(mode, btn) {
            const basicButtons = document.querySelector('.basic-buttons');
            const advancedButtons = document.querySelector('.advanced-buttons');
            const modeButtons = document.querySelectorAll('.mode-button');
            
            modeButtons.forEach(button => button.classList.remove('active'));
            btn.classList.add('active');
            
            if (mode === 'basic') {
                basicButtons.classList.add('active');
                advancedButtons.classList.remove('active');
                calcContainer.classList.remove('fullscreen');
                document.body.classList.remove('fullscreen-mode');
            } else {
                basicButtons.classList.remove('active');
                advancedButtons.classList.add('active');
                calcContainer.classList.add('fullscreen');
                document.body.classList.add('fullscreen-mode');
            }
        }

        function calculate() {
            try {
                let expression = display.value.trim();
                
                if (!expression) return;
                
                historyDisplay.textContent = expression + ' =';
                
                // Handle factorial first
                expression = expression.replace(/(\d+\.?\d*)!/g, (match, num) => {
                    const n = parseFloat(num);
                    if (n < 0 || n !== Math.floor(n)) return 'NaN';
                    if (n > 170) return 'Infinity';
                    let result = 1;
                    for (let i = 2; i <= n; i++) result *= i;
                    return result.toString();
                });
                
                // Replace constants
                expression = expression.replace(/π/g, 'Math.PI');
                // Replace standalone 'e' using word boundaries (but not Math.E, exp, etc.)
                expression = expression.replace(/\be\b/g, 'Math.E');
                
                // Handle functions (inverse functions before regular, specific before general)
                // Must process abs before other functions that might contain 'abs' substring
                expression = expression.replace(/abs\(/g, 'Math.abs(');
                expression = expression.replace(/sin⁻¹\(/g, 'Math.asin(');
                expression = expression.replace(/cos⁻¹\(/g, 'Math.acos(');
                expression = expression.replace(/tan⁻¹\(/g, 'Math.atan(');
                // Convert 10^(...) to Math.pow(10,...) - capture content inside parentheses (non-nested)
                expression = expression.replace(/10\^\(([^)]+)\)/g, 'Math.pow(10,$1)');
                expression = expression.replace(/log₁₀\(/g, 'Math.log10(');
                expression = expression.replace(/e\^\(/g, 'Math.exp(');
                expression = expression.replace(/ln\(/g, 'Math.log(');
                // Convert log( to log10 - must come before sin/cos/tan to avoid conflicts
                expression = expression.replace(/\blog\(/g, 'Math.log10(');
                expression = expression.replace(/sin\(/g, 'Math.sin(');
                expression = expression.replace(/cos\(/g, 'Math.cos(');
                expression = expression.replace(/tan\(/g, 'Math.tan(');
                expression = expression.replace(/√\(/g, 'Math.sqrt(');
                
                // Handle remaining power operator (for things like 2^3, not 10^(...))
                expression = expression.replace(/\^/g, '**');
                
                // Handle implicit multiplication
                expression = expression.replace(/(\d)(Math\.(?:PI|E))/g, '$1*$2');
                expression = expression.replace(/(Math\.(?:PI|E))(\d)/g, '$1*$2');
                expression = expression.replace(/(Math\.(?:PI|E))\(/g, '$1*(');
                expression = expression.replace(/(\))(Math\.(?:PI|E))/g, '$1*$2');
                expression = expression.replace(/(\))(\()/g, '$1*$2');
                expression = expression.replace(/(\))(\d)/g, '$1*$2');
                expression = expression.replace(/(\d)(\()/g, '$1*$2');
                
                // Input validation - whitelist check
                // After conversions, expression should only contain: digits, operators, parentheses, Math.* calls, commas, whitespace
                const cleaned = expression.replace(/Math\.(PI|E|sin|cos|tan|asin|acos|atan|log|log10|exp|sqrt|abs|pow)/g, '');
                // Check for any characters that aren't in our whitelist
                if (!/^[\d\s\+\-\*\/\(\)\.\,\*]+$/.test(cleaned)) {
                    throw new Error('Invalid characters in expression');
                }
                
                // Evaluate safely
                const result = Function('"use strict"; return (' + expression + ')')();
                
                // Format result
                if (typeof result === 'number') {
                    if (isNaN(result)) {
                        display.value = 'Error';
                    } else if (!isFinite(result)) {
                        display.value = result > 0 ? 'Infinity' : '-Infinity';
                    } else {
                        let formatted = result.toString();
                        if (formatted.includes('.')) {
                            formatted = formatted.replace(/\.?0+$/, '');
                        }
                        if (formatted.length > 15) {
                            formatted = result.toExponential(10);
                        }
                        display.value = formatted;
                    }
                } else {
                    display.value = result.toString();
                }
                
                shouldResetDisplay = true;
            } catch (error) {
                display.value = 'Error';
                historyDisplay.textContent = '';
                shouldResetDisplay = true;
            }
        }

        // Keyboard support
        document.addEventListener('keydown', function(event) {
            const key = event.key;
            
            if (key >= '0' && key <= '9' || key === '.') {
                appendToDisplay(key);
            } else if (key === '+' || key === '-' || key === '*' || key === '/') {
                appendToDisplay(key);
            } else if (key === '(' || key === ')') {
                appendToDisplay(key);
            } else if (key === 'Enter' || key === '=') {
                event.preventDefault();
                calculate();
            } else if (key === 'Escape') {
                clearAll();
            } else if (key === 'Backspace') {
                event.preventDefault();
                deleteLast();
            } else if (key === '^') {
                event.preventDefault();
                appendToDisplay('^');
            }
        });
    </script>
</body>
</html>
